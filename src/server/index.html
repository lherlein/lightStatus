<!DOCTYPE html>
<html>
<head>
    <title>Light Status</title>
    <style>
        .box {
            width: 200px;
            height: 100px;
            background-color: #f0f0f0;
            margin: 20px;
            padding: 10px;
            border: 2px solid #333;
        }
    </style>
</head>
<body style="background-color: white;">
    <div class="box" id="pixley-status">
        <h1>Pixley Light Status</h1>
        <p id="status">Loading...</p>
    </div>
    <div class="box" id="basement-status">
        <h1>Basement Light Status</h1>
        <p id="status">Loading...</p>
    </div>
    <div class="box" id="backyard-status">
        <h1>Backyard Light Status</h1>
        <p id="status">Loading...</p>
    </div>
    <script type="module">
        import fetch from 'node-fetch';
        import lightsEndpoints from '../util/endpoints';
    
        // get light status
        // pixley
    
        async function getPixleyStatus() {
            let requestOptions = {
                method: 'GET',
            };
            let url = lightsEndpoints.pixley.commands.status;
            let response = await fetch(url, requestOptions);
    
            if (response.ok) {
                let data = await response.json()
                return data;
            } else {
                throw new Error(`Error: ${response.status}`);
            }
        }
    
        async function getBasementStatus() {
            let requestOptions = {
                method: 'GET',
            };
            let url = lightsEndpoints.basement.commands.status;
            let response = await fetch(url, requestOptions);
    
            if (response.ok) {
                let data = await response.json();
                return data;
                
            } else {
                throw new Error(`Error: ${response.status}`);
            }
        }
    
        async function getBackyardStatus() {
            let requestOptions = {
                method: 'GET',
            };
            let url = lightsEndpoints.backyard.commands.status;
            let response = await fetch(url, requestOptions);
    
            if (response.ok) {
                let data = await response.json();
                return data;
                
            } else {
                throw new Error(`Error: ${response.status}`);
            }
        }
    
        function populateText(pixStatus, baseStatus, backyardStatus) {
            
            const pixInnerHtml = `<h1>Pixley Light Status</h1>\n<p id="status">${pixStatus}</p>`
            const baseInnerHtml = `<h1>Basement Light Status</h1>\n<p id="status">${baseStatus}</p>`
            const backyardInnerHtml = `<h1>Backyard Light Status</h1>\n<p id="status">${backyardStatus}</p>`
            
            const t1 = document.getElementById('pixley-status');
            const t2 = document.getElementById('basement-status');
            const t3 = document.getElementById('backyard-status');
    
            if (t1 && t2 && t3) {
                t1.innerHTML = pixInnerHtml;
                t2.innerHTML = baseInnerHtml;
                t3.innerHTML = backyardInnerHtml;
            }
        }
    
        async function main() {
            try {
                const pixStatus = await getPixleyStatus();
                const baseStatus = await getBasementStatus();
                const backyardStatus = await getBackyardStatus();
                populateText(pixStatus.POWER, baseStatus.POWER, backyardStatus.POWER);
            } catch (error) {
                console.error(error);
            }
        }
    
        main();
    </script>
</body>
</html>
